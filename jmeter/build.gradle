/*
 * This file was generated by the Gradle 'init' task.
 *
 * This is a general purpose Gradle build.
 * Learn how to create Gradle builds at https://guides.gradle.org/creating-new-gradle-builds/
 */

buildscript {
    repositories {
        maven { url "https://maven.aliyun.com/repository/central" }
    }
    dependencies {
        classpath 'net.sourceforge.jtds:jtds:1.2.4'
    }
}

plugins {
    id 'base'
    id 'distribution'
     id "net.saliman.properties" version "1.5.2"
    id "net.foragerr.jmeter" version "1.1.0-4.0"
}

jmeter {
    jmPropertyFile = file("gradle-$environmentName" + ".properties")
    enableReports = true
    enableExtendedReports = true
    ignoreErrors = true
    ignoreFailures = true

    // exclude the test file for preparate the load test data
    excludes = ["table-xx/*.jmx"]
}

// workaround report issue in this version
// https://github.com/jmeter-gradle-plugin/jmeter-gradle-plugin/issues/103
afterEvaluate {
    def jMeterExt = project.extensions.findByName("jmeter")
    jMeterExt.metaClass.enableReports = true
    jMeterExt.metaClass.enableExtendedReports = false
    jMeterExt.metaClass.reportTitle = null
    jMeterExt.metaClass.reportPostfix = ""
    jMeterExt.metaClass.reportXslt = "$projectDir/src/main/resources/jmeter-results-detail-report_21.xsl"
}

task copyToBin(type: Copy) {
    into "$buildDir/jmeter/bin"
    from "$projectDir/src/main/resources"
    include "log4j2.xml"
}

jmRun.dependsOn copyToBin
jmGui.dependsOn copyToBin
